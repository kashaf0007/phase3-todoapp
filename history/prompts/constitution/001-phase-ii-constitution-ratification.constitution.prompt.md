---
id: 001
title: Phase II Constitution Ratification
stage: constitution
date: 2025-12-30
surface: agent
model: claude-sonnet-4-5
feature: none
branch: master
user: Kashaf Aman
command: /sp.constitution
labels: ["constitution", "governance", "phase-ii", "security", "spec-driven"]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files:
  - .specify/memory/constitution.md
tests:
  - None (documentation only)
---

## Prompt

1. Purpose & Authority
This Constitution governs Phase II of the Todo Application.
Its purpose is to transform the Phase I console Todo app into a production-grade, multi-user Full-Stack Web Application using a strict spec-driven, agentic development workflow powered by Claude Code + Spec-Kit Plus.
This document is the highest authority for Phase II.
If any instruction conflicts with this Constitution, this Constitution overrides it.

2. Development Principles (Non-Negotiable)
Spec-First Development
No code may be written or modified without an explicit specification.
Claude Code must always read and reference specs using:
@specs/...
No Manual Coding
Humans do not write application code.
All implementation must be generated by Claude Code from specs.
Agentic Dev Stack Workflow
Claude Code must follow this exact sequence:
Write or read spec
‚Üí Generate implementation plan
‚Üí Break into tasks
‚Üí Implement incrementally
‚Üí Validate against acceptance criteria
Phase Isolation
Only Phase II scope is allowed.
Intermediate and Advanced features are explicitly forbidden unless added by a new spec.

3. Phase II Objective
Objective:
Build a Full-Stack Web Todo Application with persistent storage, authentication, and REST APIs while preserving all Basic Level functionality.
The application must:
Support multiple authenticated users
Persist data in Neon Serverless PostgreSQL
Enforce strict user isolation
Be fully spec-governed and reviewable

4. In-Scope Features (Phase II Only)
4.1 Core Todo Features (Mandatory)
Claude Code must implement all 5 Basic Level features:
Add Task
View Task List
Update Task
Delete Task
Mark Task as Complete
Each task must belong to exactly one authenticated user.

4.2 Authentication (Mandatory)
Implement user signup and signin
Use Better Auth (Next.js) for frontend authentication
Use JWT-based authentication for backend authorization
Backend must never trust client-provided user IDs

5. Explicitly Out of Scope (Forbidden)
Claude Code must not implement:
Priorities, tags, categories
Search, filtering, sorting
Recurring tasks
Due dates or reminders
AI features
Chatbot
Role-based access control
File uploads
Push notifications
These belong to future phases only.

6. Technology Stack (Immutable)
Claude Code must not substitute technologies.
Layer    Technology
Frontend    Next.js 16+ (App Router)
Backend    Python FastAPI
ORM    SQLModel
Database    Neon Serverless PostgreSQL
Auth    Better Auth + JWT
Specs    Spec-Kit Plus
AI Dev Tool    Claude Code

7. REST API Contract (Binding)
All APIs must follow this contract exactly.
Method    Endpoint    Description
GET    /api/{user_id}/tasks    List all tasks
POST    /api/{user_id}/tasks    Create task
GET    /api/{user_id}/tasks/{id}    Task details
PUT    /api/{user_id}/tasks/{id}    Update task
DELETE    /api/{user_id}/tasks/{id}    Delete task
PATCH    /api/{user_id}/tasks/{id}/complete    Toggle completion

‚ö†Ô∏è Important Security Rule:
Even though user_id exists in the URL, the backend must derive the real user from the JWT token, not from the path parameter.

8. Authentication & Security Constitution
8.1 JWT Rules (Mandatory)
Better Auth must issue JWT tokens
Frontend must attach JWT to every API request:
Authorization: Bearer <token>
FastAPI backend must verify JWT signature
Backend must extract user identity from token
All database queries must be filtered by authenticated user ID

8.2 Shared Secret Rule
JWT signing and verification must use:
BETTER_AUTH_SECRET
The secret must be provided via environment variables
Frontend and backend must share the same secret

8.3 Authorization Enforcement
Claude Code must ensure:
Requests without a valid token ‚Üí 401 Unauthorized
Users can only read/write their own tasks
Task ownership is enforced on every CRUD operation

9. Monorepo Constitution (Mandatory Structure)
Claude Code must respect and preserve this structure:
hackathon-todo/
‚îú‚îÄ‚îÄ .spec-kit/
‚îú‚îÄ‚îÄ specs/
‚îÇ   ‚îú‚îÄ‚îÄ overview.md
‚îÇ   ‚îú‚îÄ‚îÄ architecture.md
‚îÇ   ‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ ui/
‚îú‚îÄ‚îÄ CLAUDE.md
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îî‚îÄ‚îÄ CLAUDE.md
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îî‚îÄ‚îÄ CLAUDE.md
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md

Specs must never live next to code
Claude Code must always read the closest CLAUDE.md

10. CLAUDE.md Obedience Rule
Claude Code must obey:
Root CLAUDE.md ‚Üí global rules
/frontend/CLAUDE.md ‚Üí frontend patterns
/backend/CLAUDE.md ‚Üí backend patterns
If instructions conflict:
Root > Folder > Spec

11. Database Rules
Use SQLModel only
No raw SQL unless specified
Database schema must match:
@specs/database/schema.md
Every task row must include:
user_id ownership enforcement

12. Validation & Acceptance Criteria
Claude Code must consider Phase II complete only if:
All Basic Level features work end-to-end
Authenticated users only see their own tasks
JWT verification is enforced on every endpoint
Frontend + backend run successfully together
All behavior matches specs exactly

13. Enforcement Clause
If Claude Code:
Skips specs
Implements out-of-scope features
Writes manual code
Breaks security rules
Violates stack constraints
‚Üí The implementation is invalid and must be redone.

14. Final Directive to Claude Code
You are an agentic, spec-driven engineer.
You do not guess.
You do not improvise.
You do not code without specs.

## Response snapshot

Constitution successfully created at `.specify/memory/constitution.md` with version 1.0.0.

The constitution establishes 14 core principles organized into:
- **Core Principles**: 14 non-negotiable principles covering spec-first development, no manual coding, agentic workflow, phase isolation, multi-user auth, data persistence, user isolation, JWT security, stack immutability, API contract compliance, secret management, monorepo structure, CLAUDE.md hierarchy, and database schema compliance
- **Technology Stack**: Immutable tech stack (Next.js, FastAPI, SQLModel, Neon PostgreSQL, Better Auth, Spec-Kit Plus)
- **REST API Contract**: Binding 6-endpoint contract with critical JWT-based security rule
- **Authentication & Security**: JWT rules, shared secret management, authorization enforcement
- **Monorepo Structure**: Mandatory directory organization with specs/code separation
- **Database Rules**: SQLModel-only, schema compliance, user ownership enforcement
- **Validation & Acceptance**: 6 criteria for Phase II completion
- **Enforcement Clause**: Remediation process for violations
- **Governance**: Amendment procedures, compliance review, runtime guidance

All template validations passed:
- plan-template.md: Constitution Check section aligns
- spec-template.md: User story structure aligns with spec-first principle
- tasks-template.md: Task organization aligns with incremental implementation

## Outcome

- ‚úÖ Impact: Constitution ratified (v1.0.0), establishes governance for Phase II Todo Application Full-Stack development with strict spec-driven, agentic workflow and comprehensive security rules
- üß™ Tests: None required (governance documentation)
- üìÅ Files: Created .specify/memory/constitution.md (307 lines, 14 principles)
- üîÅ Next prompts: /sp.specify for feature specifications, /sp.plan for implementation planning, /sp.clarify for requirement clarification
- üß† Reflection: Constitution successfully transforms comprehensive user input into structured, enforceable governance document with clear principles, rationale, and compliance mechanisms

## Evaluation notes (flywheel)

- Failure modes observed: None - all placeholders resolved, templates validated, semantic versioning applied correctly
- Graders run and results (PASS/FAIL): Template validation: PASS, Placeholder resolution: PASS, Version increment logic: PASS (0.0.0 ‚Üí 1.0.0 MAJOR for initial ratification)
- Prompt variant (if applicable): N/A (initial constitution creation)
- Next experiment (smallest change to try): Test constitution enforcement by attempting to create a feature spec and validating constitutional compliance gates are triggered appropriately
